### 沈询
http://i.youku.com/i/UMTcwMTg3NDc1Mg==?spm=a2hzp.8253869.0.0

ONS(Open Notification Service)

最终一致性，全局来看，最后系统都会成功，某些系统宕机了，但是恢复为正常，就可以了，
因为消息没有被消费。

后端挂系统，前端不会受到影响。

异步和解耦区别？

消息系统，原理都很简单，难点在于权衡与取舍。

消息一定会堆积，海量数据堆积问题。

发送处理逻辑简单，

避免任何地方不能扩展，任何一点必须能够扩展，要不然瓶颈一定在哪里。

任意一个点必须是集群。

按需扩缩，无需关注架构上无法扩展。

面向扩展而设计的。

异步多队列。

消息堆积，宕机不能接受，写入消息很慢，交易过程很慢，无论堆积多少，系统不能挂，不能慢。

QPS，TPS高 因为使用内存，考虑消息堆积了吗？只要一堆积，就挂了。

kafka日志堆积，日志吞吐量，不注重延时，拉模型。

拉关注吞吐量。

推很快，订阅者不用处理业务逻辑，收消息就好，拉需要

降低消息消费延迟，推拉结合。

订阅者拉mq消息，mq此时没有消息，hold住，等有消息了在推过去。减低消息消费延时。
拉很及时。

ONS，注重分布式系统能力。
小型企业mq系统：设计思路变化。

消息处理能力不行，消息会堆积，堆积之后系统依然很好。

mqms单机，扩展很难。

为什么要分组？随机选择一台机器消费，不会发给别的机器集群。

消息乱序产生：要吞吐量+容错还是方便理解？
容易写的代码，一般性能不好，

消息发出去什么顺序，消息接收什么顺序。
发给同一个server，发两个也行，但是要通知。

最优模型，尽可能有序，乱序了在处理

付款消息先到，创建后到，也无所谓的。恰好不需要解决。


消息重复时候，针对消费者，因为网络问题。

去重成本代价很高，期望用户恰好不需要去重，方案不是从mq，而是用户自己，

走了网络一定会有重复，并非mq本身带来的问题，用户不需要，mq做了很麻烦，如果需要，需要考虑代价。

去重表。本地事务。去重表有了消息被处理， 就不需要处理，写记录，一次写变成了两次写。

恰好不需要是最好的。去重表定期删除，去重表事务的，机器资源处理去重表。

去重表 VS 好的设计？ 为什么交给用户了？

接的机器多，系统一定会堆积的。

延时很低，用户不会感受到最终一致性。

Topic和Tag，消息组：动态机器归属某个组内，消息发送者，接受者无限扩容。

rocketmq 部署了5台broker，数据分布问题，文件系统怎么保证数据一样呢？




